---
title: "Untitled"
output: html_document
---

```{r}
simple_lin_regress <- function(n, beta0 = 2, beta1, var) {
  
  sim_data = tibble(
    x = rnorm(n, mean = 0, sd = 1),                         # x pulled from standard normal distro
    y = beta0 + beta1 * x + rnorm(n, 0, sqrt(var))
  )
  
  ls_fit = lm(y ~ x, data = sim_data) %>%                   # linear model fit
    broom::tidy()                                           # turns into tibble; easier to obtain b1_hat, p-val
  
  tibble(                                                   # puts those values inside a new tibble
    beta1_hat = ls_fit[[2,2]],
    p_val = ls_fit[[2,5]]
  )
}
# beta1 values of interest
value_stor <- tibble(
  beta1_values = 0:6)
# new df that takes the assigned n, beta0, and var
value_df <- value_stor %>% 
  mutate(
    testruns = map(beta1_values, ~rerun(10000, simple_lin_regress(n = 30, beta1 = .x, var = 50)))
  ) %>% 
  unnest() %>% 
  unnest()
reject_prop <- value_df %>% 
  group_by(beta1_values) %>% 
  summarize(null_reject = sum(p_val < 0.05),
            total_obs = n()) %>% 
  mutate(
    rate_reject = (null_reject/total_obs) * 100,
    beta1_values = as_factor(beta1_values)
  )
reject_prop %>% 
  ggplot(aes(x = beta1_values, y = rate_reject, color = beta1_values, fill = beta1_values)) +
  geom_bar(stat = "identity")
value_df %>% 
  group_by(beta1_values) %>% 
  summarize(mean_beta1_hat = mean(beta1_hat)) %>% 
  mutate(beta1_values = as_factor(beta1_values)) %>% 
  ggplot(aes(x = beta1_values, y = mean_beta1_hat, color = beta1_values, fill = beta1_values)) +
  geom_point(alpha = 0.7) +
  geom_line(aes(group = 1), alpha = 0.7)
value_df %>% 
  group_by(beta1_values) %>% 
  filter(beta1_hat < 0.05) %>% 
  summarize(mean_beta_reject = mean(beta1_hat)) %>% 
  mutate(beta1_values = as_factor(beta1_values)) %>% 
  ggplot(aes(x = beta1_values, y = mean_beta_reject, color = beta1_values, fill = beta1_values)) +
  geom_point(alpha = 0.7) +
  geom_line(aes(group = 1), alpha = 0.7)
```


Make a plot showing the average estimate of β̂ 1 on the y axis and the true value of β1 on the x axis. Make a second plot (or overlay on the first) the average estimate of β̂ 1 only in samples for which the null was rejected on the y axis and the true value of β1 on the x axis. Is the sample average of β̂ 1 across tests for which the null is rejected approximately equal to the true value of β1? Why or why no

```

